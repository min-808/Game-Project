<!DOCTYPE html>
<html lang="en">
<head>
    <script src="p5.js"></script>
    <script src="game.js"></script>
    <script defer src="https://unpkg.com/p5.collide2d"></script>
    <link rel="stylesheet" href="style.css">
    <title>Game Project</title>
    <style>
    </style>
</head>
<body>
    <span id="staminaTitle">Stamina: <span id="staminaValue">placeholder</span></span>
    <span id="snakesTitle">Snakes Hit: <span id="snakesValue">placeholder</span></span>
    <span id="damageTitle">Took Damage?: <span id="damageValue">placeholder</span></span>

    <span id="frames">FPS: <span id="framesValue">placeholder</span></span>
    <script>

        let w = window.innerWidth;
        let h = window.innerHeight;

        var stamina = 60;
        var hit = false;

        var execute;
        var counter = 0;

        var bullets = [];
        var snakeAmount = [];
        //var hitboxes = [];

        var player = new player();
        var hitbox = new hitbox();

        var invis = new invisibleHitBox();

        var drawCursor = new drawCursor();
        var drawLine = new drawLine();

        //var weapon = new weapon();

        function setup() {
            frameRate(60);
            createCanvas(w,h);
            angleMode(DEGREES);
            knight = loadImage("knight.png");
            snake = loadImage("snake.png");

            for (var s = 0; s < 20; s++) { // s is snake amount
                
                /* fix this later, better randomization for spawns
                var quad = random(0, 3);

                var xQuad = 0;
                var yQuad = 0;

                if (quad == 0) {
                    xQuad = random(0, w);
                    yQuad = random(-100, 0);
                } else if (quad == 1) {
                    xQuad = random(w, 100);
                    yQuad = random(0, h);
                } else if (quad == 2) {
                    xQuad = random(0, w);
                    yQuad = random(h, 100);
                } else if (quad == 3) {
                    xQuad = random(-100, 0);
                    yQuad = random(0, h);
                }
                */

                let s = new enemy(random(-w, w), random(-w, w), random(0.5, 1));
                //let hb = new invisibleHitBox();

                snakeAmount.push(s);
                //hitboxes.push(hb);

                console.log(snakeAmount);
                //console.log(hitboxes);
            }

        }

        function draw() {
            
            clear();
            document.getElementById("staminaValue").innerText = stamina.toFixed(0);
            document.getElementById("framesValue").innerText = frameRate().toFixed(2);

            let seconds = (millis() / 1000).toFixed(0); // timer

            if (stamina >= 60) {
                stamina = 60;
            }

            drawLine.show();
            drawLine.update();

            drawCursor.show();
            drawCursor.update();
            noCursor();

            player.show();
            player.update();

            hitbox.hitReg();

            hitbox.show();
            hitbox.update();

            //checkHealthStatus();
            //checkStaminaStatus();

            if (keyIsDown(87)) {
                player.up();
                pos = "up";
            }
            if (keyIsDown(83)) {
                player.down();
                pos = "down";
            }
            if (keyIsDown(65)) {
                player.left();
                pos = "left";
            }
            if (keyIsDown(68)) {
                player.right();
                pos = "right";
            }

            /*if (keyIsDown(77)) {
                weapon.show();
                weapon.update();
            }

            if (!keyIsDown(77)) {
                weapon.fade();
            }*/

            for (var sn = 0; sn < snakeAmount.length; sn++) {
                snakeAmount[sn].display();
                snakeAmount[sn].move();

                snakeAmount[sn].displayHealthBars();
                snakeAmount[sn].updateHealthBars();

                //hitboxes[sn].display();
                //hitboxes[sn].update();
            }
            
            for (var j = bullets.length - 1; j >= 0; j--) {
                bullets[j].display();
                bullets[j].move();

                //if (bullets[j].yPos < 0) {
                    //bullets.splice(j, 1);
                //}

                for (var i = snakeAmount.length - 1; i >= 0; i--) {

                    var hit = collideRectRect(bullets[j].getxPos(), bullets[j].getyPos(), bullets[j].getWidth(), bullets[j].getHeight(), snakeAmount[i].getxPos(), snakeAmount[i].getyPos(), snakeAmount[i].getWidth(), snakeAmount[i].getHeight());

                    if (hit == true) {
                        snakeAmount[i].addCount(1);
                        //console.log(hit + " " + snakeAmount[i].getCount())

                        if (snakeAmount[i].getCount() == 11) { // current single hits do between 6 and 8 i think. depends on the speed of the bullet and framerate
                            counter++;
                            document.getElementById("snakesValue").innerText = counter;

                            bullets.splice(j, 1);
                            snakeAmount.splice(i, 1);
                            
                            break;
                        }
                    }

                }
            }

        }

        function mousePressed() {
            let mouseVector = getMouseVector();
            let b = new shoot(mouseVector.x, mouseVector.y);
            bullets.push(b);

            stamina -= 5;
        }

        // SCRAPPED WEAPON SYSTEM

        //function keyReleased() {
            //if (keyCode == 67) {
                //weapon.fade();
            //}

            //return false;
        //}

        //function keyTyped() {
            //if (key === "c") {
                //weapon.show();
            //}
        //}

    </script>
</body>
</html>